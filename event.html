<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Event</title>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
   <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
  <script type="text/javascript" src="js/bootstrap.js"></script>

  <script type="text/javascript" src="js/eventJs.js"></script>

  <!--<script type="text/javascript" src="http://demonstration.abgne.tw/jquery/plugins/0082/js/jquery.bgiframe.js"></script>-->
  <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyAqZmBR0L326jweeAj84JiwM54stfvbOIE&signed_in=true&libraries=places"></script>
  <link rel="stylesheet" herf="text/css" href="eventCss.css">
  <!--<link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">-->
  <link rel="icon" href="img/favicon.png" type="image/ico" />
  <script type="text/javascript" src="js/mix_main.js"></script>
  <script language="JavaScript" type="text/javascript">

    var CLIENT_ID = '1032454829565-mq9a352elo3m505k6eqmp79114brc1lp.apps.googleusercontent.com';
    var KEY = '2OTAi0eufTVRWhCrKB2wivpy';
    var SCOPES = ["https://www.googleapis.com/auth/calendar"];

    function resizeImage()
    {
      var window_height = document.body.clientHeight
      var window_width = document.body.clientWidth
      var image_width = document.images[0].width
      var image_height = document.images[0].height
      var height_ratio = image_height / window_height
      var width_ratio = image_width / window_width
      if (height_ratio > width_ratio)
      {
      document.images[0].style.width = "auto"
      document.images[0].style.height = "100%"
      }
      else
      {
      document.images[0].style.width = "100%"
      document.images[0].style.height = "auto"
      }
    }

      function handleAuthResult(authResult) {
          loadCalendarApi();
        
      }
	  
	  function checkAuth() {
	    //gapi.client.setApiKey(KEY);
        gapi.auth.authorize(
          {
            'client_id': CLIENT_ID,
            'scope': SCOPES.join(' '),
            'immediate': true
          });
      }
    
       /**
       * Load Google Calendar client library. List upcoming events
       * once client library is loaded.
       */
      function loadCalendarApi() {
        gapi.client.load('calendar', 'v3', listUpcomingEvents);
      }

      /**
       * Print the summary and start datetime/date of the next ten events in
       * the authorized user's calendar. If no events are found an
       * appropriate message is printed.
       */
      function listUpcomingEvents() {
        var request = gapi.client.calendar.events.list({
          'calendarId': 'primary',
          'timeMin': (new Date()).toISOString(),
          'showDeleted': false,
          'singleEvents': true,
          'maxResults': 10,
          'orderBy': 'startTime'
        });

        request.execute(function(resp) {
          var events = resp.items;
          //appendPre('Upcoming events:');
          if (events.length > 0) {
            for (i = 0; i < events.length; i++) {
              var event = events[i];
              var when = event.start.dateTime;
              if (!when) {
                when = event.start.date;
              }
              $('#event_div #event_content').append(event.summary + ' (' + when + ')' +'<br/>');
              //appendPre(event.summary + ' (' + when + ')')
            }
          } else {
                 $('event_content').appendPre("No upcoming events found");
               //appendPre('No upcoming events found.');
          }

        });
      }

       function appendPre(message) {
        var pre = document.getElementById('output');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }
    
      function deleteEvent() {
        var request = gapi.client.calendar.events.list({
              'calendarId': 'primary',
              'timeMin': (new Date()).toISOString(),
              'maxResults': 10
            });
        request.execute(function(resp) {
          var it = resp.items;
          var id = it[0].id;
          var deleteR = gapi.client.calendar.events.delete({
           'calendarId': 'primary',
           'eventId': id
           });
           deleteR.execute();
        });

       } 
      
      function search(){
        var request = gapi.client.calendar.events.list({
              'calendarId': 'primary',
              'timeMin': (new Date()).toISOString(),
              'showDeleted': false,
              'singleEvents': true,
              'maxResults': 10,
              'orderBy': 'startTime'
            });
        
            request.execute(function(resp) {
              var events = resp.items;
              var itDate = document.getElementById("eventDate").value;
          
                  if (events.length > 0) {
                    console.log("events.length>0");
                    for (i = 0; i < events.length; i++) {
                      var event = events[i];
                      //var when = event.start.dateTime;
                      var when = event.start.dateTime;
                      var sdate = when.substring(0,10);
                      if(itDate == sdate){
                      appendPre(event.summary + " " + sdate);
                      i = events.length + 1;
                      }else if (i == events.length-1){
                      appendPre("No event.");
                      }
                    }
                  } 
        });
      }

      function insert(){
        var eventName = document.getElementById("eventName").value;
        var eventstartdate = document.getElementById("eventStartDate").value;
        var eventenddate = document.getElementById("eventEndDate").value;
        var eventlocation = document.getElementById("EventLocation");
        var event = {
          'summary': eventName,
          'location':eventlocation,
          'start': {
          'date': eventstartdate
          },
          'end': {
          'date': eventenddate
          }
        };

        var request = gapi.client.calendar.events.insert({
          
          'calendarId': 'primary',
          'resource': event
        });
        
        request.execute(function(event) {
         console.log(event);
        });
      }


    </script>

    <script src="https://apis.google.com/js/client.js?onload=checkAuth">
    </script>



</head>

<body onload="handleAuthResult()">
  <div id="editDiv" title="編輯事件" style="position: relative; z-index: 99;">
    <p>
         <label for="eventName">事件名稱：</label>
         <input type="text" class="text" id="eventName" title="請輸入事件名稱">
         <span class="star">*</span>
    </p>

    <p>
         <label for="eventStartDate">事件開始日期：</label>
         <input type="date" class="date" id="eventStartDate">
         <span class="star">*</span>
    </p>

     <p>
         <label for="eventEndDate">事件結束日期：</label>
         <input type="date" class="date" id="eventEndDate">
         <span class="star">*</span>
    </p>

    <p>
         <label for="eventLocation">事件地點：</label>
         <input type="text" class="text" id="eventLocation">
         <span class="star">*</span>
    </p>
  </div>

      <nav class="navbar navbar-inverse navbar-fixed-top" style="font-size:18px" >
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Guider</a>
          </div>

          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav">
              <li class="active"><a href="#">事件列表<span class="sr-only">(current)</span></a></li>
              <li><a href="map.html">地圖導航</a></li>

            </ul>
            <ul class="nav navbar-nav navbar-right">
                  <li><a data-toggle="tab" href="#"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>&nbsp;聯絡我們</a></li>
                  <li><a data-toggle="tab" href="#"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>&nbsp;登出</a></li>

             </ul>


          </div>
      </nav>
  
  
  <div id="event_div" class="container-fluid">
  
            <div id="event_header">
                   Upcoming events:
            </div>
            <hr/>
            <div id="event_content"> 
                    
            </div> 
            <footer id="event_footer">
                <hr>
                <button type="button" class="btn btn-primary btn-lg" id="edit_button">編輯事件</button>

           </footer> 
  </div>



      <div id="search">
        <input type="date" id="eventDate">
        <button id="button" class="btn btn-info" onclick="search()"> search </button>
        <pre id="output"></pre>
      </div>
  
    


      <script src="https://www.google-analytics.com/urchin.js" type="text/javascript">
      </script>

      <meta http-equiv="content-type" content="text/html charse=utf-8">
      <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">


  </body>

</html>
